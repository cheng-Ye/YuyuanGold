# 豫园（老庙）黄金智能补货项目

心得：做这个项目最大的收获就是之前把算法仅仅局限于AI,真正领会到算法其实真的是一门交叉学科。本项目偏向于模型可解释性以及业务，所以AI在这里用的不是很多。涉及了本专业知识控制论，但是做的比较简单。。

背景：
豫园黄金珠宝智能补货项目，旨在帮助豫园集团完善过去纯以经验补货的策略，建立一个对历史数据分析并构建算法给出补货建议的平台。

主要思路：
平台使用flask框架，主要包括历史数据分析和补货建议两个功能；历史数据分析包括月畅销排行、动销率排行、月各品种销售情况、SKU级月销量走势、节假日销量统计情况。补货算法采用ABC分类法，A类即交易量大和交易量相对较小但是存在供不应求的物品，构建自适应控制系统，使用指数平滑法和带约束条件的线性回归（对预测对象的相关因子进行线性拟合，使用带约束的粒子群算法确定拟合参数）构建参考模型，以销量误差与库存水平作为调节因子构建调节器；B类即种类繁多、交易量小物品，交易量分为平稳时间序列和间断时间序列，平稳序列使用指数平滑法，而对于间断时间序列，使用conston法和聚合分解法预测下一期销量；C类即滞销品，交易量和次数非常小，若该类物品本期库存低于安全库存，则考虑进货。最终物品补货量由预测销量、库存数据和人员行为计算得出，给出本期物品的合理补货订单。


历史数据统计分析功能主要包括，月畅销排行、动销率排行、月各品种销售情况、SKU级月销量走势、节假日销量统计情况。如下图：

 


补货算法：
项目难点：
•	1.黄金珠宝属于奢侈品，相比于服装、饮食等其它快消品交易量很低，因此产品需求的时间序列中会包含有许多零值点，即间断性需求时间序列。
•	2.对于新款产品来说，往往是没有历史数据的，需求的预测往往需要借助相接近的产品做预测； 
•	3.库存产品变质率。而对于黄金产品来说，变质率指的是产品过时，产品价值减少是由于市场的变化引起的。因此，为了减少库存损失，企业对需求预测精度提出了更高的要求。
•	4. 产品间相互影响。对黄金产品来说，很多产品之间有较强的关联性和替代性，某个单独产品的策略会影响到相似产品的需求，在进行需求预测时，还要考虑这种产品间的影响。
•	5.需求不确定性强。时尚产品在成熟竞争激烈的市场中，除了消费者自身需要外，竞争对手的策略、供应商的意外情况等都会使得需求变化程度大于普通产品。因此需求的动态波动使得需求预测难度加大。

补货算法采用ABC分类法，ABC分析法源出于帕累托曲线.经济学家帕累托在研究财富的社会分配时得出一个重要结论：80%的财富掌握在20%人的手中,即“关键的少数和次要的多数”规律。
根据ABC分类原理结合黄金商品的特性，定义ABC商品如下：
A类：交易量排行于前10%和交易量排行于前30%但是存在供不应求的物品；
B类：不在A类中且交易量排行位于前30%到前10%区间内的物品；
C类：交易量排行位于30%之后的物品；

补货算法细节：
设定补货周期为1个月；
A类商品属于爆款品。 构建自适应控制系统，系统结构如下:


	
图中参考模型为指数平滑法与带约束的线性拟合（使用粒子群搜索拟合参数）的加权集成，参考模型会预测出商品在下一期的近似销量，在控制系统中参考模型是稳定不变的；调节器为本期调节系数Kt，系数由上一期的自适应机构调整得到；调节器系数乘以上一期销量与参考模型的输出之和构成了商品本期预测销量 ；自适应机构会滞后一个周期，当得到本期实际销量 与本期实际库存与安全库存差 ，会调节Kt系数大小，调整后的结果作为下一个周期调节系数Kt+1；当系统稳定时，预测销量 等于实际销量 ，
本期实际库存与安全库存差 为0，最终调节器系数不再发生变化。

参考模型:
参考模型为一次指数平滑法和带约束的线性拟合方法的加权集成。该类商品属于交易量大的商品，需求时间序列较为平稳，因此可以考虑使用指数平滑法；考虑下一个月的需求量不仅和上一个月总销量相关，还有可能与上个月最后一周的销量强相关。因此采用带约束的线性拟合的方法，人工选择影响下个月销量的因子、包括去年同期销量、本期前一周销量、本期前3个月销量以及去年同期前3个月销量；共8各因子，采用线性拟合的方法确定参数，
假设w1为去年同期销量因子权重，w2为本期前一周销量因子权重，w3-w5为本期前3个月销量因子权重,w6-w8为去年同期前3个月销量因子权重。
对每个因子权重规定如下：
 
使用粒子群搜索算法确定拟合参数，粒子群算法核心在于适应度函数（损失函数）的确定；适应度函数定义为平均绝对百分比误差，即MAPE,
 

调节器：
调节器为一个比例系数 , 计算公式如下
  
式中 , 为调节系数，这也是自适应控制系统要不断调节的系数，直至系统稳定；
 为t时刻商品的实际库存量与该商品安全库存量的差值，安全库存为一个常数；
 为t时刻商品实际销量，  为t时刻商品预测销量；

自适应机构：
自适应机构负责随时间变化不断调节 , 的大小，最终得到参数w1,w2使得系统稳定，稳定时 =0且 为0；
 , 更新如下：
 
式中 为学习率。
那么当 =0且 =0，此时 , 将不再发生变化，系统最终稳定。

B类商品：
B类商品属于销量较少、种类繁多的普通商品；
这一类商品需求时间序列大部分呈间断序列，即存在一些零值点的时间序列；呈平稳需求时间序列的此类部分商品采用指数平滑法；对于间断序列，不能使用传统的连续时间序列预测方法，传统方法会使得预测结果偏差很大。对于间断性时间序列使用conston法和基于商品相似度的聚合分解法的加权集成。

Conston方法：
Conston方法假设需求时间序列服从随机分布，在此基础上引入的一种时间间隔和需求数量的分布。当一个需求发生后,Croston方法将平均时间间隔和平均需求数量的指数平滑方法隔离开来,将间断序列分为两个子序列:一个序列由原始序列中依此产生的非零需求的大小组成;一个序列则是由非零需求之间相隔的时间点数组成。如若要对时间序列(2,3,0,0,1,0,0,0,2)进行预测,Croston方法认为其会被分为(2,3,1,2)和(2,3)两个序列。后者(2,3)正好是原序列中非零需求之间的间隔长度。而后对两个序列分别使用
简单指数平滑法进行预测
 
其中, Pt是指数平滑后的需求间隔周期，Zt是指数平滑后的需求量,下一期的需求预测为:
  							 

黄金珠宝产品之间相互影响。对黄金产品来说，很多产品之间有较强的关联性和替代性，某个单独产品的策略会影响到相似产品的需求，假设相似产品总需求呈平稳分布。
根据豫园工作人员对商品相似度的定义，认为属于同一类别、同一品种、同一几何形态、同一主题的商品认为是相似的。将本期相似商品的销量相加，作为该类商品的本期销量，这就是聚合，因为聚合后仍然可能出现很多间断时间序列，因此对聚合后的结果继续使用conston时间序列预测法。下面就是分解了，分解比较简单，每件商品预测销量为该类商品预测销量乘以上一个周期该件商品销量占比。


C类商品：
C类商品属于滞销品，可能几个月也每月销量的商品；
这类商品就没有预测了，计算该类商品当低于安全库存时，则建议补充至补货点；




